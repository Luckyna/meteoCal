<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">

        <f:metadata>
            <f:viewParam name="id" value="#{viewEvent.eventId}"/>
            <f:viewAction action="#{viewEvent.findEventById}"/>
        </f:metadata>

        <ui:define name="title">event</ui:define>

        <ui:define name="content">

            <h1><h:outputText value="#{viewEvent.eventToShow.title}" /></h1>

            <p:panelGrid columns="2" class="noBorder">
                <p:graphicImage value="/resources/img/default.png"/>
                <p:panel>
                    <p:panelGrid columns="2" class="noBorder">

                        <i class="fa fa-clock-o" /> Starts at: 
                        <h:outputText value="#{viewEvent.eventToShow.formattedStartDate}"/>
                        <i class="fa fa-clock-o" /> Ends at: 
                        <h:outputText value="#{viewEvent.eventToShow.formattedEndDate}"/>
                        <i class="fa fa-map-marker" /> Location:
                        <h:outputText value="#{viewEvent.eventToShow.location}"/>
                        <i class="fa fa-user"></i> Owner:
                        <h:outputText value="#{viewEvent.eventToShow.owner.name}"/>
                        <i class="fa fa-globe"></i> Privacy:
                        <h:outputText rendered="#{viewEvent.publicAccess}" value="public"/>
                        <h:outputText rendered="#{!viewEvent.publicAccess}" value="private"/>
                        
                        <c:if test="#{viewEvent.eventToShow.isOutdoor and viewEvent.eventToShow.hasLocation()}">
                            <h:outputLabel value="Weather:" /> <h:outputText value="#{viewEvent.eventToShow.weather.message.message } #{viewEvent.eventToShow.weather.description}"/>
                        </c:if>

                    </p:panelGrid>
                    <br/>
                    <h:outputText value="The event is outdoor" rendered="#{viewEvent.eventToShow.isOutdoor}"/><br/>
                    <h:outputText value="The event is indoor" rendered="#{!viewEvent.eventToShow.isOutdoor}"/><br/>
                </p:panel>
            </p:panelGrid>
            <h:outputLabel value="Description:" /><br />
            <p:panel>
                <h:outputText value="#{viewEvent.eventToShow.description}"/>
            </p:panel>
            <br />

            <p:tabView rendered="#{viewEvent.showInvitees}">
                <p:tab title="(#{viewEvent.acceptedInvitations.size()}) Partecipants">
                    <c:forEach items="#{viewEvent.acceptedInvitations}" var="yesUser">
                        <p:outputLabel value="#{yesUser.email}"/><br/>
                    </c:forEach>
                </p:tab>
                <p:tab title="(#{viewEvent.declinedInvitations.size()}) Declined">
                    <c:forEach items="#{viewEvent.declinedInvitations}" var="noUser">
                        <p:outputLabel value="#{noUser.email}"/><br/>
                    </c:forEach>
                </p:tab>
                <p:tab title="(#{viewEvent.noAnswerInvitations.size()}) No Asnwer">
                    <c:forEach items="#{viewEvent.noAnswerInvitations}" var="bhoUser">
                        <p:outputLabel value="#{bhoUser.email}"/><br/>
                    </c:forEach>
                </p:tab>
                <p:tab title="(#{viewEvent.publicJoinUsers.size()}) Public Join" rendered="#{viewEvent.publicAccess}">
                    <c:forEach items="#{viewEvent.publicJoinUsers}" var="publicUser">
                        <p:outputLabel value="#{publicUser.email}"/><br/>
                    </c:forEach>
                </p:tab>
            </p:tabView>

            <h:form id="formPartecipate">

                <p:commandButton value="Partecipate" update="@form" rendered="#{!viewEvent.publicJoin and !viewEvent.hasAnswered and viewEvent.publicAccess and !viewEvent.allowedToModify}" 
                                 action="#{viewEvent.doPartecipate()}"/><br/>

                <p:splitButton id="button1" value="#{viewEvent.answerMessage}" rendered="#{viewEvent.hasAnswered and viewEvent.publicAccess and !viewEvent.allowedToModify}">
                    <p:menuitem value="Decline" update="@form" actionListener="#{viewEvent.doDecline()}" rendered="#{viewEvent.publicJoin}" />
                    <p:menuitem value="Participate" update="@form" actionListener="#{viewEvent.doPartecipate()}" rendered="#{!viewEvent.publicJoin}" />
                </p:splitButton>


                <p:splitButton id="button2" value="#{viewEvent.answerMessage}" rendered="#{!viewEvent.publicAccess and !viewEvent.allowedToModify}">
                    <p:menuitem value="Partecipate" update="@form" actionListener="#{viewEvent.doPartecipate()}" rendered="#{!viewEvent.hasAnswered or !viewEvent.partecipate}" />
                    <p:menuitem value="Decline" update="@form" actionListener="#{viewEvent.doDecline()}" rendered="#{!viewEvent.hasAnswered or viewEvent.partecipate}" />
                </p:splitButton>

            </h:form>

            <p:button value="modifica" rendered="#{viewEvent.allowedToModify}" 
                      outcome="/s/manageEvent.xhtml?idEvent=#{viewEvent.eventId}" /><br/>
        </ui:define>

    </ui:composition>
</html>
