<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html  xmlns="http://www.w3.org/1999/xhtml"
       xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
       xmlns:h="http://xmlns.jcp.org/jsf/html"
       xmlns:f="http://java.sun.com/jsf/core"
       xmlns:p="http://primefaces.org/ui"
       xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:composition template="/template.xhtml">

        <f:metadata>
            <f:viewParam name="id" value="#{scheduleView.userId}"/>
            <f:viewAction action="#{scheduleView.init}"/>
        </f:metadata>

        <ui:define name="title">calendar</ui:define>

        <ui:define name="content">


            <h:panelGrid columnClasses="value">


                <p:toolbar style="margin-bottom: 12px">

                    <f:facet name="left">
                        <h:panelGrid columns="2">
                            <h:form>
                                <p:outputLabel for="console" value="Calendar:"/>
                                <p:selectOneMenu id="console" widgetVar="console" value="#{scheduleView.calendarSelected}" style="width:125px">
                                    <c:forEach items="#{scheduleView.calendarNames}" var="c">
                                        <p:ajax listener="#{scheduleView.onCalendarChange}" update=":scheduleForm:schedule, :publicSwitchForm:publicSwitch" />
                                        <f:selectItem itemLabel="#{c}" itemValue="#{c}" />
                                    </c:forEach>
                                </p:selectOneMenu>
                            </h:form>
                        </h:panelGrid>
                    </f:facet>
                    <f:facet name="right">
                        <h:form id="publicSwitchForm">
                            <h:panelGrid columns="2">
                                <p:outputLabel for="publicSwitch" value="Public:"/>
                                <p:inputSwitch id="publicSwitch" widgetVar="publicSwitch" value="#{scheduleView.calendarShown.isPublic}"/>
                            </h:panelGrid>
                        </h:form>
                        <h:form id="deleteForm">
                            <h:panelGrid columns="2" rendered="#{!scheduleView.readOnly}">
                                <p:commandButton value="Delete Calendar" onclick="PF('confirmationDialog').show()" icon="ui-icon-close" type="button"/>
                            </h:panelGrid>

                            <p:confirmDialog message="Are you sure?" global="true" widgetVar="confirmationDialog" header="Initiating delete process" severity="alert">
                                <p:commandButton type="button" value="Yes" icon="ui-icon-check" update=":growl">
                                    <f:ajax event="click" listener="#{scheduleView.canDeleteCalendar()}" />  
                                </p:commandButton> 
                                <p:commandButton type="button" value="No" icon="ui-icon-close" onclick="PF('confirmationDialog').hide()"/>
                            </p:confirmDialog>


                            <p:dialog header="Delete Options" id="delOpt" widgetVar="delOpt" minHeight="40" resizable="false">
                                <h:outputText value="Do you want to delete, move or detach the events in the calendar?" /><br/>
                                <h:form>
                                    <p:commandButton value="Move" actionListener="#{scheduleView.deleteCalendar('MOVE_EVENTS_AND_DELETE')}" oncomplete="PF('schedule').update();PF('console').update();Pf('publicSwitch').update();PF('eventDialog').hide();" />
                                    
                                    <p:commandButton value="Detach" onclick="PF('delOpt').hide()" type="button" >
                                        <f:ajax event="click" listener="#{scheduleView.deleteCalendar('DELETE_CALENDAR_ONLY')}" />
                                    </p:commandButton>
                                    <p:commandButton value="Delete" ajax="false" actionListener="#{scheduleView.deleteCalendar('DELETE_ALL')}" >
                                        
                                    </p:commandButton>
                                    
                                    <p:commandButton id="addButton" value="Save" actionListener="#{scheduleView.updateEvent}" oncomplete="PF('schedule').update();PF('eventDialog').hide();" />

                                    <p:commandButton value="Cancel" type="button" onclick="PF('delOpt').hide()" />
                                </h:form>
                            </p:dialog>

                        </h:form>

                    </f:facet>
                </p:toolbar>
                <h:form id="scheduleForm">
                    <p:schedule id="schedule" value="#{scheduleView.eventsToShow}" widgetVar="schedule" timeZone="GMT+2">

                        <p:ajax event="dateSelect" disabled="#{scheduleView.readOnly}" listener="#{scheduleView.onDateSelect}" update="eventDetails" oncomplete="PF('eventDialog').show();" />
                        <p:ajax event="eventSelect" listener="#{scheduleView.onEventSelect}" />

                    </p:schedule>
                    <p:dialog rendered="#{!scheduleView.readOnly}" widgetVar="eventDialog" header="Event Details" showEffect="clip" hideEffect="clip">
                        <h:panelGrid id="eventDetails" columns="2">
                            <h:outputLabel for="title" value="Title:" />
                            <p:inputText id="title" value="#{scheduleView.event.title}" required="true" />

                            <h:outputLabel for="from" value="From:" />
                            <p:inputMask id="from" value="#{scheduleView.event.startDate}" mask="99/99/9999">
                                <f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT+2"/>
                            </p:inputMask>

                            <h:outputLabel for="to" value="To:" />
                            <p:inputMask id="to" value="#{scheduleView.event.endDate}" mask="99/99/9999">
                                <f:convertDateTime pattern="dd/MM/yyyy" timeZone="GMT+2"/>
                            </p:inputMask>

                            <h:outputLabel for="allDay" value="All Day:" />
                            <h:selectBooleanCheckbox id="allDay" value="#{scheduleView.event.allDay}" />

                            <p:commandButton type="reset" value="Reset" />
                            <p:commandButton id="addButton" value="Save" actionListener="#{scheduleView.updateEvent}" oncomplete="PF('schedule').update();PF('eventDialog').hide();" />

                        </h:panelGrid>
                    </p:dialog>
                </h:form>



            </h:panelGrid>

            <style type="text/css">
                .value {
                    width: 1000px;
                }
            </style>
        </ui:define>

    </ui:composition>
</html>
